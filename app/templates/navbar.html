<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
       <a class="navbar-brand" href="#">Doc Assistant</a>
       <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
       <span class="navbar-toggler-icon"></span>
       </button>
       <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
             <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="modelsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span id="currentModel">Loading...</span>
                </a>
                <ul class="dropdown-menu" id="modelsList" aria-labelledby="modelsDropdown">
                   <!-- Models will be loaded here dynamically -->
                </ul>
             </li>
          </ul>
       </div>
    </div>
 </nav>
 <script>
    document.addEventListener("DOMContentLoaded", async function () {
        const currentModelElement = document.getElementById("currentModel");
        const modelsList = document.getElementById("modelsList");
    
        async function fetchCurrentModel() {
            try {
                const response = await fetch("/query/get_current_model/");
                const data = await response.json();
                currentModelElement.textContent = data.current_model || "Select Model";
            } catch (error) {
                console.error("Error fetching current model:", error);
                currentModelElement.textContent = "Error loading model";
            }
        }
    
        async function fetchModels() {
            try {
                const response = await fetch("/query/check_available_models/");
                const data = await response.json();
    
                if (data.models && data.models.length > 0) {
                    data.models.forEach(model => {
                        const listItem = document.createElement("li");
                        const link = document.createElement("a");
                        link.className = "dropdown-item";
                        link.href = "#";
                        link.textContent = model;
                        link.addEventListener("click", async () => {
                            await updateModel(model);
                        });
    
                        listItem.appendChild(link);
                        modelsList.appendChild(listItem);
                    });
                } else {
                    modelsList.innerHTML = `<li><a class="dropdown-item" href="#">No models available</a></li>`;
                }
            } catch (error) {
                console.error("Error loading models:", error);
                modelsList.innerHTML = `<li><a class="dropdown-item" href="#">Error loading models</a></li>`;
            }
        }
    
        async function updateModel(modelName) {
            try {
                const response = await fetch("/query/update_llm/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ llm_name: modelName })
                });
                const data = await response.json();
    
                if (data.status === "success") {
                    currentModelElement.textContent = data.current_model;
                } else {
                    console.error("Failed to update model:", data);
                    alert("Error updating model");
                }
            } catch (error) {
                console.error("Error updating model:", error);
                alert("Error updating model");
            }
        }
    
        await fetchCurrentModel();
        await fetchModels();
    });
 </script>