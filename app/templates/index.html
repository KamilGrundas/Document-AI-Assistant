{% extends "base.html" %}

{% block title %}Chat with Model{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Chat with Doc Assistant Model</h2>
    <div class="card">
        <div class="card-body">
            <div id="chatBox" class="mb-3" style="max-height: 300px; overflow-y: auto;">
                <!-- Chat messages will be appended here -->
            </div>
            <div class="input-group">
                <input type="text" id="userInput" class="form-control" placeholder="Type your question here...">
                <button id="sendButton" class="btn btn-primary">Send</button>
            </div>
        </div>
    </div>
</div>

<script>
    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    const sendButton = document.getElementById("sendButton");

    async function sendMessage() {
        const question = userInput.value.trim();
        if (!question) return;

        chatBox.innerHTML += `<div><strong>You:</strong> ${question}</div>`;
        userInput.value = "";
        
        try {
            const response = await fetch("/query/query_single/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ question })
            });
            const data = await response.json();

            const result = data.result || "No response available";
            chatBox.innerHTML += `<div><strong>Model:</strong> ${result}</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        } catch (error) {
            console.error("Error sending message:", error);
            chatBox.innerHTML += `<div><strong>Error:</strong> Could not retrieve answer.</div>`;
        }
    }

    sendButton.addEventListener("click", sendMessage);

    userInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            sendMessage();
        }
    });
</script>
{% endblock %}
