<div class="d-flex flex-column">
    <h5 class="text-center mb-4">List Documents</h5>
    <div id="documentList">
    </div>
    <hr>
    <h5 class="text-center mb-4">Select Vectorstores</h5>
    <div id="vectorstoreList">
    </div>
 </div>
 <script>
    async function fetchDocuments() {
        try {
            const response = await fetch("/documents/list_documents/");
            
    
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
    
            const data = await response.json();
    
            console.log("Documents fetched:", data);
    
            const documentListElement = document.getElementById("documentList");
            documentListElement.innerHTML = "";
    
            if (data.documents && data.documents.length > 0) {
                data.documents.forEach((docName) => {
                    const div = document.createElement("div");
                    div.className = "d-flex justify-content-between align-items-center mb-2";
    
                    const nameLabel = document.createElement("span");
                    nameLabel.textContent = docName;
    
                    const button = document.createElement("button");
                    button.className = "btn btn-sm btn-outline-primary";
                    button.textContent = "Collect data";
                    button.onclick = () => collectData(docName);
    
                    div.appendChild(nameLabel);
                    div.appendChild(button);
                    documentListElement.appendChild(div);
                });
            } else {
                documentListElement.innerHTML = "<p>No documents available</p>";
            }
        } catch (error) {
            console.error("Error fetching documents:", error);
            document.getElementById("documentList").innerHTML = "<p>Error loading documents</p>";
        }
    }
    
    async function fetchCurrentRetrievers() {
        try {
            const response = await fetch("/query/get_current_retrievers/");
            
    
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
    
            const data = await response.json();
            const currentRetrievers = data.retrievers || [];
    
    
            currentRetrievers.forEach(retriever => {
                const checkbox = document.getElementById(`vectorstore_${retriever}`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
        } catch (error) {
            console.error("Error fetching current retrievers:", error);
        }
    }
    
    
    async function fetchVectorstores() {
        try {
            const response = await fetch("/vectorstore/list_vectorstores/");
                        if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
    
            const data = await response.json();
            const vectorstoreListElement = document.getElementById("vectorstoreList");
    
    
            vectorstoreListElement.innerHTML = "";
    
            if (data.vectorstores && data.vectorstores.length > 0) {
                data.vectorstores.forEach((vectorstore) => {
                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.id = `vectorstore_${vectorstore}`;
                    checkbox.value = vectorstore;
                    checkbox.className = "form-check-input";
    
                    const label = document.createElement("label");
                    label.htmlFor = `vectorstore_${vectorstore}`;
                    label.className = "form-check-label";
                    label.textContent = vectorstore;
    
                    const div = document.createElement("div");
                    div.className = "form-check mb-2";
                    div.appendChild(checkbox);
                    div.appendChild(label);
    
                    vectorstoreListElement.appendChild(div);
    
    
                    checkbox.addEventListener("change", updateRetriever);
                });
    
    
                await fetchCurrentRetrievers();
            } else {
                vectorstoreListElement.innerHTML = "<p>No vectorstores available</p>";
            }
        } catch (error) {
            console.error("Error fetching vectorstores:", error);
            document.getElementById("vectorstoreList").innerHTML = "<p>Error loading vectorstores</p>";
        }
    }
    
    async function updateRetriever() {
    
        const selectedVectorstores = Array.from(document.querySelectorAll("#vectorstoreList input[type=checkbox]:checked"))
            .map((checkbox) => checkbox.value);
    
        try {
    
            const response = await fetch("/query/update_retriever/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ vectorstores: selectedVectorstores })
            });
    
            const data = await response.json();
            if (data.status === "success") {
                console.log("Retriever updated successfully:", data.current_retrievers);
            } else {
                console.error("Failed to update retriever");
            }
        } catch (error) {
            console.error("Error updating retriever:", error);
        }
    }
    
    async function collectData(filename) {
        try {
            const response = await fetch(`/vectorstore/save_vectorstore/?filename=${encodeURIComponent(filename)}`, {
                method: "POST",
            });
    
            const data = await response.json();
            if (data.status === "success") {
                alert(`Data collected successfully for ${filename}`);
                
    
                fetchVectorstores();
            } else {
                alert(`Failed to collect data for ${filename}`);
            }
        } catch (error) {
            console.error("Error collecting data:", error);
            alert("An error occurred while collecting data.");
        }
    }
    
    
    document.addEventListener("DOMContentLoaded", () => {
        fetchDocuments();
        fetchVectorstores();
    });
 </script>